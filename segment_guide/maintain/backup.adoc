// WE PULL THIS CONTENT FROM https://github.com/aporeto-inc/junon
// DO NOT EDIT THIS FILE.
// YOU MUST SUBMIT A PR AGAINST THE UPSTREAM REPO.
// THE UPSTREAM REPO IS CURRENTLY PRIVATE.

== Back up

=== Enabling backups

If you have deployed the multi-container Segment Console, you can enable
backups using Voila. This provides you with access to the following
tools.

* `backup`: to trigger a backup of the InfluxDB and MongoDB databases
* `restore`: to restore the InfluxDB and MongoDB databases

From an activated Voila environment, issue the following command to
enable backups.

[source,console]
----
set_value global.backup.enabled true override
----

Then run `doit` to deploy the backup jobs.

The backup job schedule can be changed with:

* `set_value backup.schedule " 0 0 * * *" mongodb-backup override`
* `set_value backup.schedule " 0 0 * * *" influxdb-backup override`

=== Triggering backups

The `backup` tool allows you to trigger a backup whenever you want. Just
type `backup` and follow the prompts.

=== Restoring a database

The `restore` tool allows you to restore a database using previous
backup and allows you to perform four kinds of actions:

* Restore from a backup
* Enter the container for advanced backup actions
* Push files from your machine to the backup container
* Fetch files from the backup container to your machine

=== Backing up the Voila environment

A Voila environment is set with a version control system (git).

Each time you exit an activated Voila environment, it will commit its
changes and encrypt private information like:

* certificates in `./certs` folder
* `aporeto.yaml`

This means that if the Voila environment is *not* activated, you cannot
edit those files.

Once activated, the files are decrypted and you can edit them either
from the Voila shell, or from the machine that is mounting the Voila
environment.

The Voila environment *MUST* be saved as its your entry point to manage
Segment Console upgrades and operations.

The recommended way is to push the Voila environment to a git remote
repository like GitHub or GitLab. If you donâ€™t have a git remote
repository infrastructure, just make sure to backup the Voila
environment to a safe place each time you are done using it.
