== core/authentication

=== Authn

Verifies if the given token is valid or not. If it is valid it will
return the claims of the token.

==== Relations

===== `GET /authn`

Verify the validity of a token. This is deprecated. You should use
Create.

Parameters:

* `token` (`string`): token to validate.

===== `POST /authn`

Verify the validity of a token.

==== Attributes

===== `claims` [`autogenerated`,`read_only`]

Type: `_claims`

The claims in the token.

===== `token`

Type: `string`

The token to verify. This is only used is a POST request is used.

=== Issue

Issues a new Segment token according to given data.

==== Example

[source,json]
----
{
  "audience": "aud:*:*:/namespace",
  "metadata": {
    "vinceAccount": "acme",
    "vinceOTP": 665435,
    "vincePassword": "s3cr3t"
  },
  "realm": "Vince",
  "restrictedNamespace": "/namespace",
  "restrictedNetworks": [
    "10.0.0.0/8",
    "127.0.0.1/32"
  ],
  "restrictedPermissions": [
    "@auth:role=enforcer",
    "namespace,post"
  ],
  "validity": "24h"
}
----

==== Relations

===== `POST /issue`

Issues a new token.

Parameters:

* `asCookie` (`boolean`): If set to true, the token will be delivered in
a secure cookie, and not in the response body.
* `token` (`string`): Token to verify.

==== Attributes

===== `audience`

Type: `string`

If given, the issued token will only be valid for the specified
namespace. Refer to
https://tools.ietf.org/html/rfc7519#section-4.1.3[JSON Web Token
(JWT)RFC 7519]. for further information.

===== `claims` [`autogenerated`,`read_only`]

Type: `_claims`

The claims in the token. It is only set is the parameter `asCookie` is
given.

===== `data`

_This attribute is deprecated_.

Type: `string`

Contains additional data. The value depends on the issuer type.

===== `metadata`

Type: `map[string]interface{}`

Contains various additional information. Meaning depends on the `realm`.

===== `opaque`

Type: `map[string]string`

Opaque data that will be included in the issued token.

===== `quota`

Type: `integer`

Restricts the number of times the issued token can be used.

===== `realm` [`required`]

Type:
`enum(AWSSecurityToken | Certificate | Google | LDAP | Vince | GCPIdentityToken | AzureIdentityToken | OIDC | SAML | PCC | PCCIdentityToken | AporetoIdentityToken)`

The authentication realm. This will define how to verify credentials
from internal or external source of authentication.

===== `restrictedNamespace`

Type: `string`

Restricts the namespace where the token can be used.

For instance, if you have have access to `/namespace` and below, you can
tell the policy engine that it should restrict further more to
`/namespace/child`.

Restricting to a namespace you don’t have initially access according to
the policy engine has no effect and may end up making the token
unusable.

===== `restrictedNetworks`

Type: `[]string`

Restricts the networks from where the token can be used. This will
reduce the existing set of authorized networks that normally apply to
the token according to the policy engine.

For instance, If you have authorized access from `0.0.0.0/0` (by
default) or from `10.0.0.0/8`, you can ask for a token that will only be
valid if used from `10.1.0.0/16`.

Restricting to a network that is not initially authorized by the policy
engine has no effect and may end up making the token unusable.

===== `restrictedPermissions`

Type: `[]string`

Restricts the permissions of token. This will reduce the existing
permissions that normally apply to the token according to the policy
engine.

For instance, if you have administrative role, you can ask for a token
that will tell the policy engine to reduce the permission it would have
granted to what is given defined in the token.

Restricting to some permissions you don’t initially have according to
the policy engine has no effect and may end up making the token
unusable.

===== `token` [`autogenerated`,`read_only`]

Type: `string`

The token to use for the registration.

===== `validity`

Type: `string`

Configures the maximum length of validity for a token, using
https://golang.org/pkg/time/#example_Duration[Golang duration syntax].
If it is bigger than the configured max validity, it will be capped.
Default: `24h`.

Default value:

[source,json]
----
"24h"
----

=== LDAPProvider

Allows you to declare a generic LDAP provider that can be used in
exchange for a Midgard token.

==== Example

[source,json]
----
{
  "address": "ldap.company.com",
  "baseDN": "dc=universe,dc=io",
  "bindDN": "cn=readonly,dc=universe,dc=io",
  "bindPassword": "s3cr3t",
  "bindSearchFilter": "uid={USERNAME}",
  "certificateAuthority": "-----BEGIN CERTIFICATE-----
MIIBPzCB5qADAgECAhEAwbx3c+QW24ePXyD94geytzAKBggqhkjOPQQDAjAPMQ0w
CwYDVQQDEwR0b3RvMB4XDTE5MDIyMjIzNDA1MFoXDTI4MTIzMTIzNDA1MFowDzEN
MAsGA1UEAxMEdG90bzBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABJi6CwRDeKks
Xb3pDEslmFGR7k9Aeh5RK+XmdqKKPGb3NQWEFPGolnqOR34iVuf7KSxTuzaaVWfu
XEa94faUQEqjIzAhMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8EBTADAQH/MAoG
CCqGSM49BAMCA0gAMEUCIQD+nL9RF9EvQXHyYuJ31Lz9yWd9hsK91stnpAs890gS
/AIgQIKjBBpiyQNZZWso5H04qke9QYMVPegiQQufFFBj32c=
-----END CERTIFICATE-----",
  "connSecurityProtocol": "InbandTLS",
  "default": false,
  "name": "the name",
  "protected": false,
  "subjectKey": "uid"
}
----

==== Relations

===== `GET /ldapproviders`

Retrieves the list of the namespace LDAP providers.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `POST /ldapproviders`

Creates a new LDAP provider.

===== `DELETE /ldapproviders/:id`

Deletes the provider with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /ldapproviders/:id`

Retrieves the provider with the given ID.

===== `PUT /ldapproviders/:id`

Updates the provider with the given ID.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `address` [`required`]

Type: `string`

Contains the fully qualified domain name (FQDN) or IP address of the
private LDAP server.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `baseDN` [`required`]

Type: `string`

Contains the base distinguished name (DN) to use for LDAP queries.
Example: `dc=example,dc=com`.

===== `bindDN` [`required`]

Type: `string`

Contains the DN to use to bind to the LDAP server. Example:
`cn=admin,dc=example,dc=com`.

===== `bindPassword` [`required`]

Type: `string`

Contains the password to be used with the `bindDN` to authenticate to
the LDAP server.

===== `bindSearchFilter`

Type: `string`

The filter to use to locate the relevant user accounts. For
Windows-based systems, the value may be `sAMAccountName={USERNAME}`. For
Linux and other systems, the value may be `uid={USERNAME}`.

Default value:

[source,json]
----
"uid={USERNAME}"
----

===== `certificateAuthority`

Type: `string`

Can be left empty if the LDAP server’s certificate is signed by a
public, trusted certificate authority. Otherwise, include the public key
of the certificate authority that signed the LDAP server’s certificate.

===== `connSecurityProtocol`

Type: `enum(TLS | InbandTLS)`

Specifies the connection type for the LDAP provider. `TLS` or
`InbandTLS` (default).

Default value:

[source,json]
----
"InbandTLS"
----

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `default`

Type: `boolean`

If set, this will be the default LDAP provider. There can be only one
default provider in your account. When logging in with LDAP, if no
provider name is given, the default will be used.

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `ignoredKeys`

Type: `[]string`

A list of keys that must not be imported into a Segment authorization.
If `includedKeys` is also set, and a key is in both lists, the key will
be ignored.

===== `includedKeys`

Type: `[]string`

A list of keys that must be imported into a Segment authorization. If
`ignoredKeys` is also set, and a key is in both lists, the key will be
ignored.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `subjectKey`

Type: `string`

The key to be used to populate the subject of the Midgard token. If you
want to use the user as a subject, for Windows-based systems you may use
`sAMAccountName`. For Linux and other systems, you may wish to use `uid`
(default). You can also use any alternate key.

Default value:

[source,json]
----
"uid"
----

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== Logout

Perform logout operations. This is only used to unset the secure cookie
token for now.

==== Relations

===== `GET /logout`

Performs a logout operation.

=== OIDCProvider

Allows you to declare a generic OpenID Connect (OIDC) provider that can
be used in exchange for a Midgard token.

==== Example

[source,json]
----
{
  "certificateAuthority": "-----BEGIN CERTIFICATE-----
MIIBczCCARigAwIBAgIRALD3Vz81Pq10g7n4eAkOsCYwCgYIKoZIzj0EAwIwJjEN
MAsGA1UEChMEQWNtZTEVMBMGA1UEAxMMQWNtZSBSb290IENBMB4XDTE4MDExNzA2
NTM1MloXDTI3MTEyNjA2NTM1MlowGDEWMBQGA1UEAxMNY2xhaXJlLWNsaWVudDBZ
MBMGByqGSM49AgEGCCqGSM49AwEHA0IABOmzPJj+t25T148eQH5gVrZ7nHwckF5O
evJQ3CjSEMesjZ/u7cW8IBfXlxZKHxl91IEbbB3svci4c8pycUNZ2kujNTAzMA4G
A1UdDwEB/wQEAwIHgDATBgNVHSUEDDAKBggrBgEFBQcDAjAMBgNVHRMBAf8EAjAA
MAoGCCqGSM49BAMCA0kAMEYCIQCjAAmkQpTua0HR4q6jnePaFBp/JMXwTXTxzbV6
peGbBQIhAP+1OR8GFnn2PlacwHqWXHwkvy6CLPVikvgtwEdB6jH8
-----END CERTIFICATE-----",
  "clientID": "6195189841830-0644ee9d89ef0644ee9d89examle.apps.googleusercontent.com",
  "clientSecret": "Ytgbfjtj4652jHDFGls99jF",
  "default": false,
  "endpoint": "https://accounts.google.com",
  "name": "the name",
  "protected": false,
  "scopes": [
    "email",
    "profile"
  ],
  "subjects": [
    "email",
    "profile"
  ]
}
----

==== Relations

===== `GET /oidcproviders`

Retrieves the list of OIDC providers.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `POST /oidcproviders`

Creates a new OIDC provider.

===== `DELETE /oidcproviders/:id`

Deletes the provider with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /oidcproviders/:id`

Retrieves the provider with the given ID.

===== `PUT /oidcproviders/:id`

Updates the provider with the given ID.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `certificateAuthority`

Type: `string`

Set the CA to use to contact the OIDC server. This is useful when you
are using a custom OIDC provider that doesn’t use a trusted CA. Most of
the time, you can leave this property empty.

===== `clientID` [`required`]

Type: `string`

Unique client ID.

===== `clientSecret` [`required`]

Type: `string`

Client secret associated with the client ID.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `default`

Type: `boolean`

If set, this will be the default OIDC provider. There can be only one
default provider in your account. When logging in with OIDC, if no
provider name is given, the default will be used.

===== `endpoint` [`required`]

Type: `string`

OIDC
https://openid.net/specs/openid-connect-discovery-1_0.html#IssuerDiscovery[discovery
endpoint].

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `parentID` [`autogenerated`,`read_only`]

Type: `string`

Contains the parent Segment account ID.

===== `parentName` [`autogenerated`,`read_only`]

Type: `string`

Contains the name of the parent Segment account.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `scopes`

Type: `[]string`

List of scopes to allow.

===== `subjects`

Type: `[]string`

List of claims that will provide the subject.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== PCCProvider

Allows you to declare a trusted Prisma Cloud Compute (PCC)
authentication provider. Segment will accept JSON web tokens (JWT) from
the specified PCC provider.

==== Example

[source,json]
----
{
  "certificateAuthority": "-----BEGIN CERTIFICATE-----
MIIBczCCARigAwIBAgIRALD3Vz81Pq10g7n4eAkOsCYwCgYIKoZIzj0EAwIwJjEN
MAsGA1UEChMEQWNtZTEVMBMGA1UEAxMMQWNtZSBSb290IENBMB4XDTE4MDExNzA2
NTM1MloXDTI3MTEyNjA2NTM1MlowGDEWMBQGA1UEAxMNY2xhaXJlLWNsaWVudDBZ
MBMGByqGSM49AgEGCCqGSM49AwEHA0IABOmzPJj+t25T148eQH5gVrZ7nHwckF5O
evJQ3CjSEMesjZ/u7cW8IBfXlxZKHxl91IEbbB3svci4c8pycUNZ2kujNTAzMA4G
A1UdDwEB/wQEAwIHgDATBgNVHSUEDDAKBggrBgEFBQcDAjAMBgNVHRMBAf8EAjAA
MAoGCCqGSM49BAMCA0kAMEYCIQCjAAmkQpTua0HR4q6jnePaFBp/JMXwTXTxzbV6
peGbBQIhAP+1OR8GFnn2PlacwHqWXHwkvy6CLPVikvgtwEdB6jH8
-----END CERTIFICATE-----",
  "default": false,
  "endpoint": "https://my.pcc.acme.com",
  "name": "the name",
  "protected": false
}
----

==== Relations

===== `GET /pccproviders`

Retrieves the list of the PCC providers.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `POST /pccproviders`

Creates a new PCC provider.

===== `DELETE /pccproviders/:id`

Deletes the provider with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /pccproviders/:id`

Retrieves the provider with the given ID.

===== `PUT /pccproviders/:id`

Updates the provider with the given ID.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `certificateAuthority`

Type: `string`

Set the CA to use to contact the PCC service in case it uses a non
widely trusted certificate authority.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `default`

Type: `boolean`

If set, this will be the default PCC provider. There can be only one
default provider in your account. When logging in with PCC, if no
provider name is given, the default will be used.

===== `endpoint` [`required`]

Type: `string`

The URL of the PCC service. It must use HTTPS.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== SAMLProvider

Allows to declare a generic SAML provider that can be used in exchange
for a Midgard token.

==== Example

[source,json]
----
{
  "IDPCertificate": "-----BEGIN CERTIFICATE REQUEST-----
MIICvDCCAaQCAQAwdzELMAkGA1UEBhMCVVMxDTALBgNVBAgMBFV0YWgxDzANBgNV
BAcMBkxpbmRvbjEWMBQGA1UECgwNRGlnaUNlcnQgSW5jLjERMA8GA1UECwwIRGln
aUNlcnQxHTAbBgNVBAMMFGV4YW1wbGUuZGlnaWNlcnQuY29tMIIBIjANBgkqhkiG
9w0BAQEFAAOCAQ8AMIIBCgKCAQEA8+To7d+2kPWeBv/orU3LVbJwDrSQbeKamCmo
wp5bqDxIwV20zqRb7APUOKYoVEFFOEQs6T6gImnIolhbiH6m4zgZ/CPvWBOkZc+c
1Po2EmvBz+AD5sBdT5kzGQA6NbWyZGldxRthNLOs1efOhdnWFuhI162qmcflgpiI
WDuwq4C9f+YkeJhNn9dF5+owm8cOQmDrV8NNdiTqin8q3qYAHHJRW28glJUCZkTZ
wIaSR6crBQ8TbYNE0dc+Caa3DOIkz1EOsHWzTx+n0zKfqcbgXi4DJx+C1bjptYPR
BPZL8DAeWuA8ebudVT44yEp82G96/Ggcf7F33xMxe0yc+Xa6owIDAQABoAAwDQYJ
KoZIhvcNAQEFBQADggEBAB0kcrFccSmFDmxox0Ne01UIqSsDqHgL+XmHTXJwre6D
hJSZwbvEtOK0G3+dr4Fs11WuUNt5qcLsx5a8uk4G6AKHMzuhLsJ7XZjgmQXGECpY
Q4mC3yT3ZoCGpIXbw+iP3lmEEXgaQL0Tx5LFl/okKbKYwIqNiyKWOMj7ZR/wxWg/
ZDGRs55xuoeLDJ/ZRFf9bI+IaCUd1YrfYcHIl3G87Av+r49YVwqRDT0VDV7uLgqn
29XI1PpVUNCPQGn9p/eX6Qo7vpDaPybRtA2R7XLKjQaF9oXWeCUqy1hvJac9QFO2
97Ob1alpHPoZ7mWiEuJwjBPii6a9M9G30nUo39lBi1w=
-----END CERTIFICATE REQUEST-----",
  "IDPIssuer": "https://accounts.google.com/o/saml2/idp?idpid=AbDcef123",
  "IDPURL": "https://accounts.google.com/o/saml2/idp?idpid=AbDcef123",
  "default": false,
  "name": "the name",
  "protected": false,
  "subjects": [
    "email",
    "profile"
  ]
}
----

==== Relations

===== `GET /samlproviders`

Retrieves the list of the namespace SAML providers.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `POST /samlproviders`

Creates a new LDAP provider.

===== `DELETE /samlproviders/:id`

Deletes the provider with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /samlproviders/:id`

Retrieves the provider with the given ID.

===== `PUT /samlproviders/:id`

Updates the provider with the given ID.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `IDPCertificate`

Type: `string`

Identity Provider Certificate in PEM format.

===== `IDPIssuer`

Type: `string`

Identity Provider Issuer (also called Entity ID).

===== `IDPMetadata`

Type: `string`

Pass some XML data containing the IDP metadata that can be used for
automatic configuration. If you pass this attribute, every other one
will be overwritten with the data contained in the metadata file.

===== `IDPURL`

Type: `string`

URL of the identity provider.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `default`

Type: `boolean`

If set, this will be the default SAML provider. There can be only one
default provider in your account. When logging in with SAML, if no
provider name is given, the default will be used.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `subjects`

Type: `[]string`

List of claims that will provide the subject.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.
