== Trigger Registry Scans with Webhooks

You can use webhooks to trigger a scan when images in your registry's repositories are added or updated.

Prisma Cloud supports webhooks for:

* https://docs.docker.com/docker-hub/webhooks/[Docker Hub]
* https://docs.docker.com/registry/notifications/[Docker Registry]
* https://docs.microsoft.com/en-us/azure/container-registry/container-registry-webhook/[Azure Registry]
* https://help.sonatype.com/repomanager3/integrations/webhooks#:~:text=Webhooks%20are%20defined%20as%20an,events%20happening%20within%20Nexus%20Repository[Nexus Repository]
* https://www.jfrog.com/confluence/display/JFROG/Webhooks[JFrog Artifactory]

[NOTE]
====
Prisma Cloud requires Docker Registry 2.4 or later.
// https://stackoverflow.com/questions/32660206/docker-registry-vs-docker-trusted-registry

Google Container Registry and Amazon Elastic Container Registry do not currently support webhooks.
====

For Docker Hub, you must have Automated Builds enabled for your repository.
Docker Hub webhooks are called when an image is built or a new tag is added to your automated build repository.

For Docker Private Registry, webhooks are called when manifests are pushed or pulled, and layers are pushed or pulled.
Prisma Cloud scans images in response to layer push events.

For Azure Registry, you can configure webhooks for your container registry that generate events when certain actions are performed against it. See https://docs.microsoft.com/en-us/azure/container-registry/container-registry-webhook-reference/[Azure's documentation] for more information.

The Console needs a valid and trusted certificate for the webhook to work on JFrog Cloud.

To trigger a webhook for JFrog Cloud registry, enter a valid and trusted certificate while xref:./scan-artifactory.adoc[configuring your self-hosted JFrog Artifactory].

Prisma Cloud also supports xref:../../configure/configure-scan-intervals.adoc#[scheduled registry scans], with support for most of the registry types, including Google Container Registry and Amazon Elastic Container Registry.


=== Securing Console's Management Port

Webhooks call the Prisma Cloud API on Console's management ports over either HTTP or HTTPS.

ifdef::compute_edition[]
Although it is convenient to test webhooks with HTTP, we strongly recommend that you set up webhooks to call Console over HTTPS.
To call webhooks over HTTPS, you must install a certificate trusted by the registry.
For more information about securing Console's management port with a custom certificate, see
xref:../../configure/certificates.adoc[certificates customization for Console TLS communication].
endif::compute_edition[]

NOTE: By default, Prisma Cloud uses self-signed certificates to secure HTTP traffic.
Self-signed certificates are not supported (trusted) by Docker Hub, and Docker Registry would require you to configure Prisma Cloud as a trusted CA certificate (not supported, and not recommended).
Instead install a certificate signed by a trusted certificate authority (CA), such as Comodo or Symantec.


[.task]
=== Setting up Webhooks

To set up webhook-initiated scans, configure your registry's webhook with the URL provided in Console.
The following procedure shows you how to set up webhooks in Docker Hub.

*Prerequisites:* Docker Hub, with Automated Builds enabled.

[.procedure]
. Open Console.

. Go to *Compute > Defend > Vulnerabilities > Images > Registry settings*.

ifdef::compute_edition[]
. Go to *Defend > Vulnerabilities > Images > Registry settings*.
endif::compute_edition[]

ifdef::compute_edition[]
. In *Webhooks*, select the DNS name or IP address that the registry uses to reach Prisma Console. This generates a URL that you can use to configure the registry.
endif::compute_edition[]

. In *Webhooks*, copy the URL to your webhook configuration.

. Configure your repository.
+
The following sections show how to configure Docker Hub and Nexus Repository.
For other repositories, consult the vendor's documentation.
+
* <<configure-docker-hub,Docker Hub>>
* <<configure-nexus-repository,Nexus Repository>>

. Test the integration by triggering a build.
+
image::trigger_registry_scan_webooks_706509.png[width=800]

. Go to *Monitor > Vulnerabilities > Images > Registries* to view the scan report.
Prisma Cloud scans the image as soon as it is built.

[.task, #_configure_docker_hub]
=== Create a Webhook in Docker Hub

[.procedure]
. Log in to Docker Hub.

. In your chosen repository, select *Webhooks*.

.. Enter a name for the webhook.

.. Paste the webhook URL that you copied from Prisma Console.

.. Select *Create*.
+
image::trigger_registry_scan_webhooks_docker_hub.png[scale=20]

[#configure-nexus-repository]
=== Create a Webhook in Nexus Repository

When setting up webhooks in Nexus Repository, select the "component" event type for triggering the webhooks.

image::trigger_registry_scan_webhooks_nexus.png[width=800]
