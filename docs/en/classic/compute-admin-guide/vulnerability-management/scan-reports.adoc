== Vulnerability Scan Reports

Prisma Cloud scans images, hosts, and functions to detect vulnerabilities.
The Prisma Cloud Intelligence Stream keeps Console up to date with the latest vulnerabilities.
The data in this feed is used for agentless scanning and is also distributed to your Defenders for scanning purposes.
The initial scan is triggered when a Defender is installed, or when you enable agentless scanning, the scans check for:

* Published Common Vulnerabilities and Exposures (CVEs)
* Vulnerabilities from misconfigurations
* Malware
* Zero-day vulnerabilities
* Compliance issues
* Secrets
After the initial scan, subsequent scans are triggered:

* Periodically, according to the xref:../configure/configure-scan-intervals.adoc[scan interval] configured in Console. By default, images are scanned every 24 hours.
* When new images are deployed onto the host.
* When scans are forced with the *Scan* button in Console.

Through Console, Defender can be extended to scan images for custom components.
For example, you can configure Defender to scan an internally developed library named `libexample.so`, and set a policy to block a container from running if `libexample.so` version `1.9.9` or earlier is installed.
For more information, see Scanning custom components.

[.task]
=== View Image Scan Reports

Review the health of all images in your environment.

// See: https://github.com/twistlock/twistlock/issues/16987
NOTE: Sorting the table on vulnerability severity based on data from the last scan.
If you update your vulnerability policy with a different alert threshold, rescan your images if you want to be able to sort based on your new settings.

[.procedure]
. Open Console, then go to *Monitor > Vulnerabilities > Images*.
+
The table summarizes the state of each image in your environment.
+
All vulnerabilities identified in the last image scan can be exported to a CSV file by clicking the *CSV* button in the top left of the page.
+
NOTE: In case multiple images share the same image ID, but with different tags on different hosts, then these will be shown using +<Num> in the Tag column, as can be seen in the screenshot below.
+
image::image_scan_reports_summary_with_multiple_tags.png[width=800]

. Click on an image report to open a detailed report.

. Click on the *Vulnerabilities* tab to see all CVE issues.
+
CVE vulnerabilities are accompanied by a brief description.
Click *Show details* for more information, including a link to the report on the National Vulnerability Database.
+
[NOTE]
====
The *Fix Status* column contains terms such as 'deferred', 'fixed in...', and 'open'.
These strings are imported directly from the vendors' CVE databases.
They are not Prisma Cloud-specific.

image::image-scan-reports.png[scale=20]
====

=== Tagging Vulnerabilities

To help you manage and fix the vulnerabilities in your environment, you can assign tags to each vulnerability. The list of available tags is defined under *Manage > Collections and Tags > Tags > Tag definition* (see xref:../configure/tags.adoc#[Tag definition]). To assign a tag to a vulnerability, click on the *Add Tags to CVE* action in the *Tags* column.

//image::scan_reports_add_tag.png[width=800] The above image is sufficient to show the feature.

Tagging a vulnerability will apply by default to the CVE ID, package, and resource you assigned the tag from. You can granularly adjust and extend the tag scope under *Manage > Collections and Tags > Tags > Tag assignment* (see xref:../configure/tags.adoc#[Tag assignment]).

For example, assigning a tag from the following scan report will apply to _CVE-2020-16156_, package _perl_, and image _ubuntu:20.04_.

image::scan_reports_tag_scope.png[width=800]

You can also add comments to each tag assignment, for example, to explain the reason this tag was added.
Do it by clicking the comment icon on the left side of the tag.

//image::scan_reports_tag_comment.png[width=800] Unnecessary, the above image is sufficient

By default, all vulnerabilities, according to your policy, are listed.
However, you can also examine vulnerabilities only with specific tags.
Use the drop-down list to filter by tags.

image::scan_reports_tags_filter.png[width=800]

Remove a tag from a vulnerability using the close action available on the tag. 

When removing a tag from the scan report, the entire tag assignment is removed, which may be wider than just the single place you remove it from. For example, removing a tag that is applied to image _ubuntu:20.04_ by a tag assignment defined for images _ubuntu:*_, will remove the entire tag assignment, which means the tag will be removed from all _ubuntu_ images.

For more granular tag removal, go to the *Manage > Collections and Tags > Tags > Tag assignment*, and adjust the relevant tag scope.

=== Per-layer Vulnerability Analysis

To make it easier to understand how images are constructed and what components have vulnerabilities, Prisma Cloud correlates vulnerabilities to layers.
This tool helps you assess how vulnerabilities were introduced into an image, and pick a starting point for remediation.

To see the layer analysis, click on an image to open the scan report, then click the *Layers* tab.

image::image_scan_reports_layers_tool.png[scale=20]

NOTE: There are differences in the scan results between an image created by a Dockerfile and an image pulled by a registry. 
This is because the times in the image created by Dockerfile are more accurate. Therefore the vulerability scan results from the Dockerfile are more accurate.

[.section]
==== RHEL Images

The Prisma Cloud layers tool shows the instructions used to create each layer in an image.
RHEL images, however, don't contain the necessary metadata, so the Prisma Cloud layers tool shows an empty black box.

image::image_scan_reports_rhel_image.png[width=800]

To validate that the required metadata is absent, run _docker history IMAGE-ID_ on a non-RHEL image.
The _CREATED BY_ column is fully populated.

image::image_scan_reports_docker_history_normal.png[width=600]

Next, run _docker history IMAGE-ID_ on an RHEL image.
Notice that the _CREATED BY_ column is empty.

image::image_scan_reports_docker_history_rhel.png[width=600]


=== Packages Information

Prisma Cloud uses risk scores to calculate the severity of vulnerabilities in your environment.


Scan reports have a *Package info* tab, which lists all the packages installed in an image or host.
It also shows all active packages, which are packages used by running software.

To see these active packages, open a scan report, open the *Package info* tab, and look at the *Binaries* column (see the *App* column in host scan reports).
This column shows what's actually running in the container.
For example, the fluent/fluentd:latest container in the following screenshot runs _/usr/bin/ruby_.
One of the packages utilized by the Ruby runtime is the bigdecimal gem.
If you were prioritizing mitigation work, and there was a severe vulnerability in bigdecimal, bigdecimal would be a good candidate to address first.

image::scan_reports_packages_in_use.png[width=600]

=== Process Information

Prisma Cloud scan reports provide visibility over the startup processes of the image.
To see the image startup processes, open a scan report and go to the *Process info* tab.

The processes list is created by a static analysis of the image, which first parses the image history to get the list of startup binaries.
The algorithm then iterates over the image binaries and tries to find these startup binaries on the disk (in the file system).
Those which were found are displayed under the *Process info* tab.

image::scan_reports_process_info.png[width=600]


=== Per-finding Timestamps

The image scan reports of Prisma Cloud show the following per-vulnerability timestamps:

* Age of the vulnerability based on the discovery date.
This is the first date that the Prisma Cloud scanner found the vulnerability.

* Age of the vulnerability based on its published date.
This represents the date the vulnerability was announced to the world.

Registry scan reports show the published date only.

image::scan_reports_timestamped_findings.png[width=600]

Timestamps are per-image, per-vulnerability.
For example, if CVE-2019-1234 was found in image foo/foo:3.1 last week and image bar/bar:7.8 is created from foo/foo:3.1 today, then the scan results for foo show the discovery date for CVE-2019-1234 to be last week and for bar it shows today.

Timestamped findings are useful when you have time-based SLAs for remediating vulnerabilities (e.g. all critical CVEs must be fixed within 30 days).
Per-finding timestamp data makes it possible to track compliance with these SLAs.


=== Host and VM Image Scanning

Prisma Cloud also scans your hosts and VM images for vulnerabilities.
To see the scan report for your hosts and VM images, go to *Monitor > Vulnerabilities > Hosts*.

By default, all vulnerable packages, according to your policy, are listed.
However, you can also examine vulnerabilities specific to an app (systemd service).
Use the drop-down list to select an app.
Clear the selection to see all vulnerabilities for a host/VM image.

image::scan_reports_host_apps.png[width=400]

The *Package Info* tab lists all packages installed on the host/VM image.
If a package has a component utilized by a running app, the affected running apps are listed in the *Apps* column.


Prisma Cloud also collects and displays package license details.
License information is available at all places where package details are displayed,
such as *Monitor > Vulnerabilities > Images* (under the *Package Info* tab),
*Monitor > Vulnerabilities > Hosts* and *Monitor > Vulnerabilities > Registry*, as well as the corresponding API endpoints.

image::image_scan_reports_761336.png[width=400]

NOTE: Licensing compliance is supported only for viewing purposes and cannot be included in policies for alert/block capabilities.


=== Scan Status

The initial scan can take substantial time when you have a large number of images. Subsequent scans are much faster.

To see the status of the image scans, go to *Monitor > Vulnerabilities > Images*.

Each row in the table represents an image in your environment.

If an image is being scanned, a progress bar shows the status of the scan.
If there is no progress bar, the scan has been completed.


=== Package Types

Prisma Cloud uses compliance identification numbers to designate the package type when reporting vulnerabilities in images.
Compliance IDs can be found in the CSV export files and API responses.

To download image reports in CSV format, go to *Monitor > Vulnerabilities > Images*, and click the *CSV* button at the top of the table.
The *Compliance ID*, *Type*, and *Packages* fields report the package ID, package type, and package name respectively.
The API output reports compliance IDs only.

image::scan_reports_csv_packages.png[width=850]

The following table shows how compliance IDs map to package type.

[cols="1,1", options="header"]
|===
|Compliance ID number
|Package type

|46
|Operating system/distro packages

|47
|JAR files

|48
|Gem files

|49
|Node.js

|410
|Python

|411
|Binary

|412
|Custom (set by customer)

|415
|Nuget

|416
|Go
|===
