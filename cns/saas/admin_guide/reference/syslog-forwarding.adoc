
== Enable Syslog Forwarding

You can enable `syslog` forwarding under *Enforcer Profile*.
Optionally, you can configure the header format used in the `syslog` messages and enable client authentication for `syslog` over TLS.

If you enable syslog forwarding without defining a syslog server endpoint, enforcers write events to the host subsystem. This can be useful if you already have a syslog collector in your host, but it only works for Linux based systems and on environments where your enforcers have permissions to write to the platform's disk. Many managed platforms don't allow your enforcers to write to the platform's disk which will cause an error.

You must configure the following log fields:

* *Syslog Endpoint* IP address or fully qualified domain name (FQDN) of the syslog server and the port number where the syslog messages are sent.

* *Facility:* Select a syslog standard value. The default value is 1 or `LOG_USER` to calculate the priority (PRI) field in your syslog server implementation.

* *Format:* Select the syslog format used for messages: `AUTO`, `BSD` or `IETF`. Traditionally, BSD format is used over UDP and IETF format is used over TCP or SSL/TLS connections.

=== Configure Syslog Forwarding for UDP Connections

The following example adds a *Syslog Collector* listening on UDP connections, over port `514`, which is the default syslog port.

After <<enable-syslog-forwarding,enabling syslog forwarding>>, you can provide the endpoint address in the following format: `<protocol://<fqdn or ip>:<port>`

image::syslog-1.png[width=600,align="center"]

=== Configure Syslog Forwarding for TCP Connections
The following example adds a *Syslog Collector* listening on TCP connections over port `50514`.

After <<enable-syslog-forwarding,enabling syslog forwarding>>, you can provide the endpoint address in the following format: `<protocol://<fqdn or ip>:<port>`

image::syslog-2.png[width=600,align="center"]

=== Configure Syslog Forwarding for TLS Connections
The following example adds a *Syslog Collector* listening on TLS connections over port `50140`.

After <<enable-syslog-forwarding,enabling syslog forwarding>>, you can provide the endpoint address in the following format: `<protocol://<fqdn or ip>:<port>`

In addition to providing the endpoint details, TLS connections require that you upload the client and server certificates. Follow these steps to upload the certificates to the Prisma Cloud Console.

* Step 1 - Navigate to Manage -> Credentials > Certificate Management: Here we need to add the Public/Private key certificates of the Host where the Enforcer is installed (syslog tls client).

image::syslog-3.png[width=600,align="center"]

[NOTE]
This step is required as Prisma Cloud needs to securely store the certificate that it is going to be used by the Enforcers to establish the tls connection.

* Step 2 - Navigate to Agent > Enforcer Profile: Add the syslog client and server public certificates.

image::syslog-4.png[width=600,align="center"]

[NOTE]
Upload the certificates in the pem format

=== Displaying the syslog configuration
Expanding the Enforcer Profile gives you visibility on what syslog configuration is defined and mapped against the Enforcers on a given namespace.

[TIP]
As different Enforcers can use different Profiles, you can use this flexibility to define different syslog endpoints, according to your needs.

=== Enabling Syslog using apoctl
In some situations, you may want to configure syslog through your automation pipeline and apoctl can help you to make this simple.

Some examples are provided below:

* UDP syslog server endpoint configuration:
`apoctl api update enforcerprofile 61dfcc367e57760001d6c609 -k syslogEnabled=true -k syslogEndpoint="udp://10.128.0.25:50514" -k syslogFormat=BSD`


* TCP syslog server endpoint configuration:
`apoctl api update enforcerprofile 61dfcc367e57760001d6c609 -k syslogEnabled=true -k syslogEndpoint="tcp://10.128.0.25:50514" -k syslogFormat=IETF`

* TLS syslog server endpoint:
First we create a service certificate:

`apoctl api update servicecertificate 61d61b1e3186970001065ec8 \
--api https://api.staging.network.prismacloud.io \
--namespace /796475962542846976/vivek-test/aporeto \
--data '{
 "name": "syslog-servicecert",
 "public": "<public certificate content>",
 "private": "<private certificate content>"
}'`

* Next, we configure the Enforcer Profile:

apoctl api update enforcerprofile 61dfcc367e57760001d6c609 \
--api https://api.staging.network.prismacloud.io \
--namespace /796475962542846976/vivek-test/aporeto \
--data '{
 "syslogEndpointTLSClientCertificate": "<certificate content>",
 "syslogEndpointTLSServerCA": "<certificate content>",
 "syslogEndpoint": "tls://10.128.0.25:50514",
 "syslogFacility": null,
 "syslogFormat": "IETF"
}'
----

