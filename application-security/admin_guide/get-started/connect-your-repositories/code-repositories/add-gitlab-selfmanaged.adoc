:topic_type: task

[.task]
== Add GitLab Self-Managed to Prisma Cloud Code Security

Integrating Prisma Cloud with GitLab Self-Managed makes it possible for Cloud Application Security to scan your Infrastructure-as-code files (Terraform and CloudFormation) and monitor configuration issues in development.

To ensure network reachability between your GitLab environment and Prisma Cloud Application Security, as a prerequisite you are required to add the Prisma Cloud IP addresses and hostname for Application Security to an allow list, to https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin/get-started-with-prisma-cloud/enable-access-prisma-cloud-console.html[enable access to the Prisma Cloud Console].

The hostname or IP address you provide must also be resolvable on the public DNS.

It is recommended to perform the integration when logged on to GitLab with Admin user permissions.

[.procedure]

. Access GitLab Self-managed on Prisma Cloud Application Security.

.. Select *Settings* > *Code & Build Providers* > *Add*
+
image::add-repository.png[width=600]

.. Select *GitLab Self-managed*.
+
image::gitlab-selfm-1.png[width=600]

.. Enter your GitLab Self-Managed domain to configure the domain on Prisma Cloud Application Security and then select *Register*.
+
image::gitlab-selfm-2.png[width=575]
+
You will be redirected to a new page to register a new OAUTH app on GitLab Self-managed.

. Register GitLab Self-managed domain.

.. Copy *Application Name* and *Redirect URI* from *Register OAUTH app*.
+
image::gitlab-selfm-3.png[width=575]

.. Access the *GitLab Self-Managed > User Settings > Applications* and paste the copied values of Application Name as *Name* and Redirect URI as *Redirect URI*.
+
image::gitlab-selfm-4.png[width=575]

.. Select *api*, and *Save application*.
+
image::gitlab-selfm-5.png[width=575]

.. Copy *Application ID* and *Secret values*.
+
image::gitlab-selfm-6.png[width=575]

. Authorize Prisma Cloud Application Security to GitLab Self-managed.

.. Access *Set Client ID and Secret* and paste the copied values of *Application ID* and *Secret* and then select *Authorize*.
+
image::gitlab-selfm-7.png[width=575]

. Select repositories to scan.

.. Select the repositories to scan and then select *Next*.

.. A *New account successfully configured* message appears after you have successfully set up the configurations and then select *Done*.
+
Your configured GitLab Self-Managed repositories will appear on the *Code & Build Providers* page. On your next GitLab Self-managed scan, the scan results will include the new configured repositories. Access xref:projects.adoc[Projects] to view the scanned results.

. Verify that the GitLab Self-managed integration is successful:

.. Select *Settings* > *Code & Build Providers* > select the *CI/CD Systems* tab.

.. Verify that the status of the *GitLab Self-managed* integration under *Status* displays *Succeeded*.
+
NOTE: You may have to wait for up to three minutes before the status of the integration is updated and displays *Succeeded*.

[.task]
=== Support for multiple integrations

Prisma Cloud supports multiple integrations for GitLab Self-Managed. After the initial integration with Prisma Cloud, you can continue to add additional organizations and workspaces using a different or a same user or team token.
Multiple integrations from a single Prisma Cloud account enables you to:

* View a list of integrations on a single console.
* Update existing integrations by modifying the selection of workspaces.
* Add additional integrations using user or team tokens.
* Delete an existing integration.

[.procedure]

. Add additional integrations to a configured GitLab Self-Managed account.

.. Select *Settings* > *Code & Build Providers* > *Add*.

.. Under *Code Repositories* select *GitLab Self-Managed*.

.. Select *Add Integration* in the wizard that is displayed.

//image::gl-sm-add-integration.png[800]

The *Configure Domain* step of the installation wizard is displayed - see step 1c above.

//.. Execute steps 1c, 2-5 of the GitLab Self-Managed installation process above.

The new integration is displayed in the *Configured Integrations* step of the wizard. Your configured GitLab Self-managed repositories will appear on the *Code & Build Providers* page. On your next GitLab Self-managed scan, the results will include the new configured repositories.
//Access xref:projects.adoc[Projects] to view the scanned results.

// verify if Code Security has not been changed

=== Manage Integrations

Manage integrations from the integration wizard.

//. Repeat steps 1-2 of Support for multiple integrations above  select the menu under *Actions*.

* Add or remove repositories from GitLab Self-Managed: Select *Reselect repositories*

* Delete a GitLab Self-Managed integration: Select *Delete integration*


// To check if deleting a single integration within the account deletes the account configuration on Prisma Cloud console.

