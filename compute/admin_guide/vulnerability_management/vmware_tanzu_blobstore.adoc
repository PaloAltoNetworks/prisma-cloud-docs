== VMware Tanzu blobstore scanning

Prisma Cloud for TAS can scan the droplets in your blobstores for vulnerabilities.
Prisma Cloud can be configured to scan your blobstores periodically.
Defenders are the entities that perform the scanning.

NOTE: When you install Tanzu Application Service (TAS) Defender in your environment, it automatically scans the running apps and hosts in your environment without any special configuration required.

Tanzu stores large binary files in blobstores.
Blobstores are roughly equivalent to registries.
One type of file stored in the blobstore is the droplet.

Droplets are archives that contain ready to run applications.
They are roughly equivalent to container images.
Droplets contain the OS stack, a buildpack (which contains the languages, libraries, and services used by the app), and custom app code.
Before running an app on your infrastructure, the Cloud Controller stages it for delivery by combining the OS stack, buildpack, and source code into a droplet, then storing the droplet in a blobstore.

The _twistcli_ command line tool also lets you scan droplet files directly.
You can integrate _twistcli_ into your CLI to pass or fail builds based on vulnerability thresholds.


[.task]
=== Configure Prisma Cloud to scan a blobstore

Prisma Cloud can scan internal and external blobstores, and blobstores configured to use the Fog Ruby gem or WebDAV protocol.

NOTE: External blobstores that require a custom authentication flow, such as those offered by cloud providers, are not supported.

*Prequisite:* You've already xref:../install/install_defender/install_tas_defender.adoc[installed TAS Defender] in your environment.

[.procedure]
. Log into Prisma Cloud Console.

. Go to *Defend > Vulnerabilities > VMware Tanzu blobstore*.

. Click *Add blobstore*.

. Specify the cloud controller.

. Specify a Defender to execute the scanning.
+
Prisma Cloud lists all the agentIDs where Defender is installed.
To correlate the agentID to the Diego cell's IP address, and determine which host runs a Defender, log into any Diego cell, and inspect _/var/vcap/instance/dns/records.json_.
This file shows the correlation between agentID and host IP address.

. Specify the droplets to scan.
To scan all droplets, enter a wildcard (`{asterisk}`).

. Specify the maximum number of droplets to scan.
To scan all droplets, enter 0.

. Click *Add*.

. Click *Save*.


[.task]
=== Review scan reports

Scan reports show all vulnerabilities found in the droplets in your blobstores.
By default, droplets are rescanned every 24 hours.

A droplet, which is an artifact of the app staging process, contains the minimum required data to specify an app (binaries/libraries).
Droplets are stored in blobstores.
Review scan reports for droplets in *Monitor > Vulnerabilities > VMware Tanzu blobstore*.

When an application is run in a Diego cell, it's run on top of a stack, currently cflinuxfs3, which is derived from Ubuntu Bionic 18.04.
Defender automatically scans all running applications (buildpack and docker).
Review the scan reports for running apps in *Monitor > Vulnerabilities > Images*.

If you compare the findings for a buildpack app in *Monitor > Vulnerabilities > VMware Tanzu blobstore* and *Monitor > Vulnerabilities > Images*, you'll notice a difference in the number of findings.
Remember that *Monitor > Vulnerabilities > Images* reports any additional findings in the app's underlying stack that would not be found in the droplet alone.

NOTE: When TAS stages Docker-based apps, it doesn't stage an associated droplet in the blobstore.
Therefore, blobstore scanning alone won't cover Docker-based apps.
If you're running Docker containers in TAS, and you want to scan the images before they run, then configure Prisma Cloud to xref:../vulnerability_management/registry_scanning/scan_docker_registry_v2.adoc[scan the container registry].

[.procedure]
. Log into Prisma Cloud Console.

. Go to *Monitor > Vulnerabilities > VMware Tanzu blobstore* to see a list of summary reports for each droplet.

. To drill into a specific scan report, click on a row in the table.
