== Agentless scanning

Agentless scanning lets you inspect the risks and vulnerabilities of a virtual machine without having to install an agent or affecting the execution of the instance.
Prisma Cloud gives you the flexibility to choose between agentless and agent-based security using Defenders.
Currently, Prisma Cloud supports agentless scanning on AWS hosts for vulnerabilities.
Agentless capabilities will continue to be enhanced over future releases in parallel with Defender capabilities.

ifdef::compute_edition[]

=== Prerequisites

* Before configuring agentless scanning for your cloud accounts, ensure you have added an access key with the required permissions to Prisma Cloud.
+
. Navigate to *System > Authentication > Credential store*.
+
. Click on *Actions* button in the right corner where you can download the list of required agentless permissions.
+
You can also manually download the file from https://cdn.twistlock.com/docs/downloads/Agentless_Permissions.pdf[here].

* Ensure you have connectivity to Prisma Cloud Console over HTTPS from your cloud account.
+
By default, Prisma Cloud uses the default security group with default VPC for connection back to Console.
Optionally, you can specify a custom security group to use for connection to Console by providing security group name in the configuration settings. Prisma Cloud will automatically lookup VPC assigned, from the provided security group. 


endif::compute_edition[]

ifdef::prisma_cloud[]

=== Prerequisites

* https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin/connect-your-cloud-platform-to-prisma-cloud/onboard-your-aws-account/add-aws-cloud-account-to-prisma-cloud.html[Onboard your AWS, Azure or GCP account], and ensure you select the *Monitor and Protect* mode on Prisma Cloud. 
+
The specific permissions to perform Agentless scanning in your cloud accounts are documented in the CFT for the *Read-Write (Limited)* role.

* For currently onboarded accounts, if onboarded using the *Monitor* mode, switch to *Monitor and Protect* or selectively update the permissions for agentless scanning from the permissions documented in the template for the *Read-Write (Limited)* role. 

* If the existing account was onboarded for *Monitor and Protect*, update the CFT for the new permissions.

* Ensure you have connectivity to the Prisma Cloud Compute Console from your cloud account.
+
Prisma Cloud uses the default VPC and security group for AWS and GCP accounts, to connect to Console.  
If default groups are not available for connection, you can specify a custom security group in the configuration settings.
// For agentless scanning, Prisma Cloud creates temporary EC2 spot instances and infrastructure within this VPC for the scan and uses the security group to communicate with the Prisma Cloud console.
In Azure, Prisma cloud automatically creates security group for connection if one is not available.

endif::prisma_cloud[]

=== Prerequisites

* Ensure you have connectivity to the Prisma Cloud Compute Console from your cloud account.
+
Prisma Cloud uses the default VPC and security group for AWS and GCP accounts, to connect to Console.  
If default groups are not available for connection, you can specify a custom security group in the configuration settings.
// For agentless scanning, Prisma Cloud creates temporary EC2 spot instances and infrastructure within this VPC for the scan and uses the security group to communicate with the Prisma Cloud console.
In Azure, Prisma cloud automatically creates security group for connection if one is not available.

* Ensure you have agentless permissions applied to the cloud account. The templates are available for downloading after adding account credentials.
Learn more in xref:../configure/configure-agentless-scanning.adoc[platform-specific configuration].

=== Architecture

There are two ways you can set up agentless scanning with Prisma Cloud.

* Scan all hosts of a cloud account within the same cloud account (called 'target' account which is independent), or
* Scan all hosts of a cloud account (target account which is dependent on another account) in another dedicated cloud account (called 'scan hub account'). 

*Option 1: Scan within the same account*

. Onboard cloud accounts inside Prisma Cloud Compute with specific permissions required for agentless setup.
These permissions can be downloaded from UI during agentless scan setup. 
. Prisma Cloud enumerates instances in each account and creates snapshots for each instance.
. Prisma Cloud starts spot instances within the customer’s accounts, attaches snapshots, injects twistcli, performs analysis.
These instances will be referred to as "scanners".
. Scanners send results to Console and then get deleted.
. Process repeats for periodic scans.

NOTE: In the downloaded tarball, the cloud formation template that applies to this setup has the suffix *_target_user_permissions.json*.

*Option 2: Scan within a dedicated cloud account*

. Onboard accounts with different permissions for dedicated scan hub account which will perform all scans vs other target accounts that have hosts to be scanned.
. Prisma Cloud only spins up scanners in the dedicated scan hub cloud account and attaches snapshots of instances from other accounts to the scanners in this account. 
. Scanners send results to Console and then get deleted.
. Process repeats for periodic scans.

NOTE: In the AWS downloaded tarball, the cloud formation template that applies to the target account (account that needs to be scanned) has the suffix *_hub_target_user_permissions.json* and the cloud formation template that applies to the scan hub account (account that is dedicated for scanning all other accounts) has the suffix *_hub_user_permissions.json*. In GCP, there are three templates. An additional template is required to be added to each target cloud project for creating service token from hub project.

NOTE: Hub account setup is not available for Azure accounts.

=== Configure a scan

You can use agentless scanning in multiple platforms.
Each platform requires you to complete a xref:../configure/configure-agentless-scanning.adoc[platform-specific configuration].

=== Results
Agentless scan results are cohesively integrated with Defender results throughout the Console with no separate API calls or dashboards to provide seamless experience regardless of underlying architecture.

Agentless scans provide - 

* Host vulnerabilities scans
* Host Compliance and https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin-compute/compliance/custom_compliance_checks[custom compliance] scans
* Unscanned region detection with Cloud Discovery integration
* Pending OS security updates 

==== Vulnerability scans

Navigate to *Monitor > Vulnerabilities > Hosts* to view agentless vulnerability scan results.
You can see a column named *Scanned by* in the results page.
On the rows where entry is *Agentless*, scan results are provided by agentless scanning. 

Agentless scans provide risk factors associated with each vulnerability such as package in use, exposed to internet, etc. (https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin-compute/compliance/compliance_explorer[here]).
You can add tags and create policies in alert mode for exceptions.
Agentless scanning is integrated with Vulnerability Explorer and Host Radar. 

image::agentless_results.png[width=800]

==== Compliance scans

Navigate to *Monitor > Compliance > Hosts* to view agentless compliance scan results.
You can see a column named *Scanned by* in the results page.
On the rows where entry is *Agentless*, scan results are provided by agentless scanning. 

image::agentless_compex.png[width=800]

Agentless scans provide risk factors associated with each compliance issue and overall compliance rate for host benchmarks. (learn more https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin-compute/vulnerability_management/vuln_explorer[here]).
You can add tags and create policies in alert mode for exceptions.
Agentless scanning is integrated with Compliance Explorer and Host Radar. 

==== Pending OS updates

Unpatched OSes lead to security risks and greater possibility of exploits. 
Through agentless scanning, find pending OS security updates as a compliance check.

image::agentless_pendingOS.png[width=800]

You can search for all hosts with pending OS updates by searching for "Ensure no pending OS updates" string in Compliance explorer page (Monitor > Compliance > Compliance eExplorer tab).

*Syntax:*
 <package name> [<current version>] (<new version available> …)

==== Cloud Discovery Integration

When cloud discovery is enabled, agentless scans are automatically integrated with the results to provide visibility into all regions and cloud accounts where agentless scanning is not enabled along with undefended hosts. 

image::agentless_cloud.png[width=800]

*Scan Settings:*
Periodic scans occur every 24 hours by default.
You can change the scan interval under *Manage - System > Scan - Agentless* setting.
You can also perform on-demand scans by clicking the *Agentless scan* button on any of the Monitor pages or by selecting specific accounts under *Manage > Cloud accounts > Scan button* for bulk scanning.




