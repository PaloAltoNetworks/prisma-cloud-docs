== Runtime defense for Serverless functions

Prisma Cloud lets you monitor and enforce process, network and filesystem activity within your Serverless functions. 
Prior to defining a Serverless runtime policy, make sure you installed Serverless defenders on your functions. Policies let you define:

* Process activity - enables specifying specific whitelisted processes, blocking all processes except the main process and detecting cryptomining attempts.
* Network activity - enables monitoring and enforcement of DNS resolutions, inbound and outbound network connections.
* Filesystem activity - enables defining specific paths in an allowed or denied list.

Besides runtime policy, you can also configure multiple xref:../waas/waas.adoc[WAAS] application firewall protections to defend your functions from application layer attacks.


=== Securing your Serverless functions
To secure Serverless functions, follow the steps below:

. Define your policy in Prisma Cloud Console under *Defend > Runtime > Serverless policy*.
. Embed the Serverless Defender into your function either manually or with Auto-defend:
.. xref:../install/install_defender/install_serverless_defender.adoc[Manually embed a Serverless Defender]
.. xref:../install/install_defender/install_serverless_defender_layer.adoc[Use a Lambda layer to embed a Serverless Defender]
.. xref:../install/install_defender/auto_defend_serverless.adoc[Use Auto-defend to deploy Serverless Defenders]


[.task]
==== Defining your policy

Add runtime protection for your Serverless function by defining a runtime rule for it in Prisma Cloud Console.

NOTE: Prisma Cloud ships without a Serverless runtime policy.
Serverless Defenders fetch the policy from the TW_POLICY environment variable and dynamically during runtime from the console (every 2 minutes).

By default, new rules apply to functions (`{asterisk}`), but you can target them to specific functions and regions using xref:../configure/rule_ordering_pattern_matching.adoc[pattern matching].

[.procedure]
. Log into Prisma Cloud Console.

. Go to *Defend > Runtime > Serverless Policy*.

. Click *Add rule*.

.. Enter a rule name.

.. By default, the rule applies to all functions in all regions and accounts.
+
Target the rule to specific functions.

.. Click the *Networking* tab.

.. Enable *DNS* toggle 

.. Set *Effect* to *Prevent*.

.. Add _*amazon.com_ to the *DNS allow list*
+
NOTE: Rules are designed to allow by default.
When adding a domain to the allow list, then everything outside the allow list is denied by default.
The above rule will block all traffic except *amazon.com related domains.

.. Click *Save*.

====  View runtime audits

To view the security audits, go to *Monitor > Events > Serverless Audits*.
You should see audits with the following messages:

  DNS resolution of domain name yahoo.com triggered by /usr/bin/wget explicitly denied by a runtime rule
