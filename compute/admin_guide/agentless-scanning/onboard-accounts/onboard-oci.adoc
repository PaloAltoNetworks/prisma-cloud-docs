[#oci-onboarding]
== Onboard Oracle Cloud Infrastructure (OCI) Accounts for Agentless Scanning

Agentless scanning lets you inspect the risks and vulnerabilities of a virtual machine without having to install an agent or affecting the execution of the instance. Prisma Cloud gives you the flexibility to choose between agentless and agent-based security using Defenders. Currently, Prisma Cloud supports agentless scanning on Oracle Cloud Infrastructure (OCI) for vulnerabilities and compliance. To learn more about how agentless scanning works, refer to our article on xref:../agentless-scanning-results.adoc[Agentless scanning architecture].

This guide enables Agentless scanning for Prisma Cloud Compute Edition (PCCE, self-hosted) in OCI. 
The procedure shows you how to complete the following tasks.

. Create an OCI compartment to run the needed instances in OCI that perform the agentless scanning.

. Create a new OCI user for Prisma Cloud to access OCI.

. Create an API key in OCI for the new user.

. Configure the Prisma Cloud console to access the OCI resources.

. Apply the needed permissions in OCI.

. Start an agentless scan.

[.task]
=== Create an OCI Compartment

[.procedure]

. Go to the Oracle Cloud console.
+
image::agentless-oci-home.png[width=800]

. In the menu, go to *Identity & Security > Compartments*.
+
image::agentless-oci-id-menu-compartments.png[width=800]

. Click *Create Compartment*.
+
image::agentless-oci-create-compartments.png[width=800]

. Enter a name and a description for the compartment.
+
image::agentless-oci-create-compartments-name.png[width=800]

. Click *Create Compartment*.
+
[NOTE]
====
To scan all resources across all regions, you must create the resources for the different regions in the compartment.
Make sure to create all needed resources with the same name in all regions.
====

[.task]
=== Create a New OCI User

[.procedure]

. In the menu, go to *Identity & Security > Users*.
+
image::agentless-oci-id-menu-users.png[width=800]

. Click *Create User*.
+
image::agentless-oci-create-user.png[width=800]

. Select *IAM User*.

. Enter a *Name* and a *Description* for the user.
+
image::agentless-oci-create-user-fields.png[width=800]

. Click *Create*.
+
image::agentless-oci-create-user-button.png[width=800]

[.task]
=== Create an API Access Key

[.procedure]

. On the user page, go to *Resources > API Key*.
+
image::agentless-oci-user.png[width=800]

. Select *Generate API Key Pair*.
+
image::agentless-oci-api-keys.png[width=800]

. Click *Download Private Key*.
+
image::agentless-oci-download-private-key.png[width=800]

. Click *Add*.
+
image::agentless-oci-add-key-button.png[width=800]

. The *Configuration File Preview* opens.
+
image::agentless-oci-configuration-file-preview.png[width=800]

.. Copy the key-value pair for `user` into a text file.

.. Copy the key-value pair for `fingerprint` into a text file.

.. Copy the key-value pair for `tenancy` into a text file.
+
image::agentless-oci-configuration-file-preview-fields.png[width=800]

.. Save the text file.

. Click *Close*.
+
image::agentless-oci-configuration-file-preview-close.png[width=800]

[.task]
=== Configure the Prisma Cloud Console

[.procedure]

ifdef::compute_edition[]

. Log into your Prisma Cloud Console.

. Go to *Manage > Cloud accounts*.
+
image::agentless-manage-cloud-accounts.png[width=800]

endif::compute_edition[]

ifdef::prisma_cloud[]

. Log into your Prisma Cloud Console.
+
image::prisma-cloud-console-pcee.png[width=800]

. Go to *Compute > Manage > Cloud accounts*.
+
image::agentless-manage-cloud-accounts-pcee.png[width=800]

endif::prisma_cloud[]

. Click *Add account*.
+
image::agentless-add-account.png[width=800]

. Under *Select cloud provider*, pick *Oracle*.
+
image::agentless-oci-account-configuration.png[width=800]

. Provide a name for the account.
+
image::agentless-oci-account-configuration-name.png[width=800]

. Under *Tenancy*, paste the value you got from the OCI *Configuration File Preview*.
+
image::agentless-oci-account-configuration-tenancy.png[width=800]

. Under *User*, paste the value you got from the OCI *Configuration File Preview*.
+
image::agentless-oci-account-configuration-user.png[width=800]

. Under *Fingerprint*, paste the value you got from the OCI *Configuration File Preview*.
+
image::agentless-oci-account-configuration-fingerprint.png[width=800]

. Open the downloaded private key and paste it under *Private key*.
+
image::agentless-oci-account-configuration-private-key.png[width=800]

. Click *Next*.
+
image::agentless-oci-account-configuration-next.png[width=800]

. Select the public URL that the Prisma Cloud Console uses to connect to OCI.
+
image::agentless-oci-agentless-configuration-url.png[width=800]

. Enter the name of the created OCI compartment.
+
image::agentless-oci-agentless-configuration-compartment.png[width=800]

. Configure any *Advanced settings* you need.
+
image::agentless-oci-agentless-advanced-settings.png[width=800]
+
[NOTE]
====
Any resources like VCN, subnet, or security group you want to use must exist in the compartment you created.
Create the resources using the same name in every region you wish to scan.
====

. Under *Download permission templates*, click *Download*.
+
image::agentless-oci-agentless-configuration-download-template.png[width=800]

. Click *Add account*.
+
image::agentless-oci-agentless-configuration-add-account.png[width=800]

[.task]

=== Apply the Permissions in OCI

[.procedure]

. Go to the Oracle Cloud console.
+
image::agentless-oci-home.png[width=800]

. Click on the terminal icon on the right hand corner and select *Cloud Shell*.
+
image::agentless-oci-cloud-shell.png[width=800]

. Click the gear icon on the shell, and select *Upload File*.
+
image::agentless-oci-upload-file.png[width=800]

. Select the `pcc-apply-permissions.sh` permission template you downloaded from the Prisma Cloud Console.

. Make the file executable with the following command.
+
[source]
----
chmod +x pcc-apply-permissions.sh
----

. Apply the permissions with the following command. Replace <OCI-Compartment> with the name of the created compartment.
+
[source]
----
apply pcc-apply-permissions.sh <OCI-Compartment>
----

. Verify that the changed statements for the policy are correct and enter `y` to continue.

. Enter `y` to dismiss the warning about tags.

. Once the permissions are applied, you have an OCI user with the needed permissions.

[.task]
=== Start an Agentless Scan

[.procedure]

ifdef::compute_edition[]

. Go to your Prisma Cloud Console.

. Go to *Manage > Cloud accounts*.
+
image::agentless-manage-cloud-accounts.png[width=800]

endif::compute_edition[]

ifdef::prisma_cloud[]

. Log into your Prisma Cloud Console.
+
image::prisma-cloud-console-pcee.png[width=800]

. Go to *Compute > Manage > Cloud accounts*.
+
image::agentless-manage-cloud-accounts-pcee.png[width=800]

endif::prisma_cloud[]

. Click the scan icon in the upper right corner of the table.
+
image::agentless-start-scan.png[width=800]

. Select *Start Agentless scan*.

. To verify your scan started, go to *Monitor > Vulnerabilities > Hosts*.

. Look for the *Start agentless scan* button.
+
image::agentless-start-scan-button.png[width=800]

. If the scan started successfully, the button is replaced with the *Stop Agentless* button.
+
image::agentless-stop-scan.png[width=800]

