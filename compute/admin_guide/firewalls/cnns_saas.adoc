== Cloud Native Network Segmentation (CNNS)

Cloud Native Network Segmentation (CNNS) is a Layer 4 container-aware virtual firewall and network monitoring tool that enables network segmentation and compartmentalization as a part of a comprehensive defense strategy.

CNNS works as an east-west firewall for containers and hosts. 
When enabled, CNNS automatically discovers how entities in your environment communicate, and shows the communication mesh on Radar.
Radar has a container and a host view, where you can view the network topology for your containerized apps and hosts respectively.
You can then define rules to enforce what traffic to allow or block across the network entities. 
It enables you to  identify and block known and unknown traffic moving laterally through your environment.


[#_architecture]
=== Architecture

Defender monitors how your containers and hosts connect and communicate with each other in real-time.

The Defender inspects the connection before it is set up.
Defender adds iptables rules to observe TCP's three-way handshake.
The three-way handshake sets up new connections using SYN messages.
For each pod or container IP address, Defender adds an iptables rule with the target set to NFQUEUE.
NFQUEUE is an iptables target which delegates the decision of how to handle a packet to a userspace program (in this case Defender).
When SYN messages arrive, Defender evaluates them to track connections.
From this vantage point, Defender can see all connections.

After a connection is established, traffic flows directly between source and destination without any further oversight from Defender.

=== Using Radar 

The following screenshot shows the mesh Radar draws for a typical microservices app.
Radar draws directed edges for each connection, and displays the associated port number.
An instance count for each node shows how many copies of the image are running as containers.
Black bubbles mean the runtime model is in enforcement mode.
Blue bubbles mean the runtime model is in learning mode.

image::cnnf_scenario1.png[width=800]


=== Network objects

Network objects represent sources and destinations.
You can define network object for any entity or resource that your host or application interacts with and these can be internal or external, non-containerized services.
For example, a payment gateway might pass information to an external service to verify transactions.

Network objects can represent container images, subnets, and hosts.
You can create new network objects representing a range of IP addresses or a single IP address.
Radar shows any connection established to the network object:

image::cnnf_scenario5.png[width=800]

To create a network object, go to *Defend > Firewalls > Cloud Native Network Firewall*, and *Add Network Object*. You must specify an IP address or subnet for a range of IP addresses.


[#_enabling_cnnf]
[.task]
=== Enabling CNNF

CNNF runs in one of two modes: Disabled or Enabled.

Disabled::
CNNF displays limited traffic flow data on Radar, including outbound connections to the Internet and connections local to the node iteself.
By default, CNNF ships in the disabled state.

Enabled::
CNNF monitors all connections, including connections across hosts and connections to any configured network objects.

[.procedure]
. Open Console.

. Go to *Defend > Radars > Settings*.

. Enable CNNF for hosts and containers.
