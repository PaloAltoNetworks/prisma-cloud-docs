== Ensure MFA is enabled for all IAM users with a console password
Bridgecrew
Prisma Cloud
*MFA is not enabled for all IAM users with a console password* 



=== Description 


Multi-Factor Authentication (MFA) provides increased security to a user name and password.
Users must possess a registered device that emits a time-sensitive key and have knowledge of a credential to authenticate successfully.
When a user with MFA enabled signs in to an AWS website, they will be prompted for their user name, password and an authentication code from their AWS MFA device.
We recommend enabling MFA for all IAM users that have accounts with a console password.
*Example* The AWS Support Center provides technical support, customer services, and is used for incident notification and response.
You should create a dedicated IAM account role to allow authorized users to manage incidents and communicate with the AWS Support Center.
This role should have MFA enabled.

=== Fix - Runtime


*AWS Console* 


To enable MFA using the AWS Console, follow these steps:

. Log in to the AWS Management Console as an *IAM user* at https://console.aws.amazon.com/iam/.

. In the navigation pane, select *Users*.

. In the *User Name* list, select the name of the user to add.

. Select the *Security Credentials* tab, then choose *Manage MFA Device*.

. In the *Manage MFA Device **wizard select **A virtual MFA device*, then select *Next Step*.
+
[NOTE]
====
IAM generates and displays configuration information for the virtual MFA device, including a QR code graphic. The graphic is a representation of the 'secret configuration key' that is available for manual entry on devices that do not support QR codes.
====

. Open your virtual MFA application.
+
** See *Virtual MFA Applications* for a list of apps that you can use for hosting virtual MFA devices.
+
** If the virtual MFA application supports multiple accounts (multiple virtual MFA devices), select the option to create a new account (a new virtual MFA device).

. Use your MFA device to either scan the QR code or manually configure the key.
+
The virtual MFA device will start generating one-time passwords.

. In the **Manage MFA Device **wizard:
+
** In *Authentication Code 1* field type the one-time password from the virtual MFA device.
+
** Wait up to 30 seconds for the device to generate a new one-time password.
+
** In *Authentication Code 2* field type the second one-time password.
+
** Select *Active Virtual MFA*.
+
[NOTE]
====
Remediation Amazon has published a pattern that forces users to self-service setup MFA. Until this step is successfully complete users cannot access services.
 This pattern can be used on new and existing AWS accounts.
 \nWe recommend users with existing AWS accounts are given instructions and a grace period to complete setup MFA on their account prior to active enforcement.
====


*CLI Command* 


Following through on example of IAM role to access AWS Support Center, reference using the Amazon unified command line interface.
Create an IAM role for managing incidents with AWS:
Create a trust relationship policy document that allows +++&lt;iam_user>+++to manage AWS incidents, and save it locally as /tmp/TrustPolicy.json.


[source,json]
----
{
  "codes": [
    {
      "code": "{
"Version": "2012-10-17", "Statement": [
{

"Effect": "Allow",

"Principal": {

"AWS": "&lt;span style="font-style: italic;">&lt;iam_user>&lt;/span>"},
  "Action": "sts:AssumeRole" } ] }  ",
      "language": "json"
    }
  ]
}
----
To create the IAM role using the above trust policy, use the following command:+++&lt;/iam_user>++++++&lt;/iam_user>+++
[,bash]
----
aws iam create-role
--role-name &lt;aws_support_iam_role>
--assume-role- policy-document file:///tmp/TrustPolicy.json
----
To attach *AWSSupportAccess* managed policy to the created IAM role, use the following command:
[,bash]
----
aws iam attach-role-policy
--policy-arn &lt;iam_policy_arn>
--role-name &lt;aws_support_iam_role>
----
