:topic_type: task

[.task]
== Add Azure Repos to Prisma Cloud Code Security

Integrating Prisma Cloud with Azure Repos makes it possible for Cloud Code Security to scan your Infrastructure-as-code files (Terraform and CloudFormation) and monitor configuration issues in development.
As a prerequisite you are required to add the Prisma Cloud IP addresses and hostname for Code Security to an allow list, to https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin/get-started-with-prisma-cloud/enable-access-prisma-cloud-console.html#id7cb1c15c-a2fa-4072-%20b074-063158eeec08[enable access to the Prisma Cloud Console].
The integration uses an Azure DevOps user token for configuration. Prisma Cloud for Azure Repos supports multiple user tokens where you can add one or more Azure Repos to a new or existing integration. You can configure the integration two ways:

[#using-single-organization-configuration]
* Using Single Organization configuration.
+
Use a single organization configuration to integrate an Azure Repos account using a single user token with the Prisma Cloud console. In Prisma Cloud, a single user token associates with an organization by default. If you have more than one user token across multiple organizations, you can use this configuration to integrate with Prisma Cloud and manage security scans from the console.

[#using-multiple-organization-configuration]
* Using Multiple Organization configuration.
+
Use a multiple organization configuration to integrate Azure Repos account using a user token with https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/change-application-access-policies?view=azure-devops['Third-party application access via OAuth' enabled]. Before you configure, verify if your user token has https://docs.microsoft.com/en-us/azure/devops/organizations/security/change-organization-collection-level-permissions?view=azure-devops&tabs=preview-page#change-permissions-for-a-group[permissions in Project Collection Administrators] in the Azure DevOps console. As a member of the Project Collection Administrators group, you can manage and create multiple organizations, including https://docs.microsoft.com/en-us/azure/devops/organizations/security/change-organization-collection-level-permissions?view=azure-devops&tabs=preview-page#add-members-to-the-project-collection-administrators-group[adding multiple members to the group]. Manage permissions for the group by https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/assign-access-levels-by-group-membership?view=azure-devops#add-group-rule[adding a rule] on the Azure DevOps console. Integrating a user token in multiple organization configurations gives Prisma Cloud access to all organizations and the repositories associated with the account for security scans.

Multiple user token is currently available only for repositories integrated on Azure Repos. Support for repositories integrated on GitLab or Bitbucket is not yet available.

[.procedure]

. Access Azure Repos on Prisma Cloud Code Security.

.. Select *Settings > Repositories > Add Repositories*.

.. Select *Azure Repos*.
+
image::azure-repos-select.png[width=800]
+
Single Organization configuration appears by default.
+
image::azure-repos.png[width=600]

. Authorize and configure Azure Repos account with Prisma Cloud console.

.. Select *Authorize* to configure an Azure Repos account with <<using-single-organization-configuration, Single Organization>>.
+
image::azure-repos-1.png[width=600]
+
If there is an existing Azure Repos integration, you can continue with the single organization configuration to integrate another Azure Repos account with Prisma Cloud.
+
image::azure-repos-2.png[width=600]
+
You can optionally select *Multiple Organization* and then *Authorize* to configure an Azure Repos account with <<using-multiple-organization-configuration, Multiple Organization>>.
+
image::azure-repos-3.png[width=600]

.. Access Azure DevOps console and then select *Accept* to authorize Prisma Cloud console to access your organization account and repositories.
+
For existing Azure Repos integration, you can additionally choose to either *Reselect repositories* or *Revoke Oauth User Token*. If there is only a single Azure Repos integration then revoking the Oauth user token will delete the integration entirely.
+
image::azure-repos-4.png[width=600]

. Select repositories corresponding to a user token for security scans.

.. Select the user token to view corresponding repositories.
+
image::azure-repos-5.png[width=600]

.. To select repositories for scan, you can choose from the following options.
+
* *Permit all existing repositories*: This option gives Prisma Cloud access to scan all existing repositories that are part of the user token.
* *Permit all existing and future repositories*: This option gives Prisma Cloud access to scan all existing repositories and any new repositories that are part of the user token.
* *Choose from repository list*: This option helps you view the list of repositories that are a part of the user token, enabling you to select specific repositories for a scan.
+
NOTE: A single repository may be shared across one or more user tokens. In this case, any change made to a shared repository scan is an applicable to all associated user tokens.
+
image::azure-repos-6.png[width=600]
+
You can also manage repository scans for integrated user tokens by selecting the corresponding user token to make the changes.

.. Select *Next* to confirm the repository selection and save the changes.
+
image::azure-repos-7.png[width=600]
+
The Azure Repos integration you added displays on *Settings > Repositories.*
+
On *Repositories* you can view the new integrated Azure Repos either from columns of *Repository* or *VCS User Token* and can additionally manage the integration by reselection of repositories, deletion of repository and the integration. However, for an account integration through multiple organization configuration you cannot delete the integration from *Repositories*.
+
* *Reselect repositories*: Enables you to access the list of repositories for a scan.
* *Delete repository*: Enables you to delete repositories for a scan from the account.
* *Manage VCS user tokens*: Enables you to integrate one or more Azure Repos account.
+
image::azure-repos-8.png[width=600]
+
After a code security scan access *Code Security > Projects* to view the latest integrated Azure Repos repository to https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin-code-security/scan-monitor/monitor-fix-issues-in-scan[Suppress] or https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin-code-security/scan-monitor/monitor-fix-issues-in-scan[Fix] the policy misconfigurations.
