:topic_type: task

[.task]
== Scan images on Amazon EC2 Container Registry (ECR)

To scan a repository, Prisma Cloud has to authenticate with ECR using either an IAM user (service account) or IAM role.
The minimum permissions policy required is *AmazonEC2ContainerRegistryReadOnly*.
It is a managed, predefined policy.
AWS managed policies grant the minimum set of permissions required for common use cases so you don't need to spend a lot of time investigating permissions yourself.

The *AmazonEC2ContainerRegistryReadOnly* permissions policy is currently defined as follows:

```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "ecr:GetAuthorizationToken",
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:GetRepositoryPolicy",
                "ecr:DescribeRepositories",
                "ecr:ListImages",
                "ecr:DescribeImages",
                "ecr:BatchGetImage"
            ],
            "Resource": "*"
        }
    ]
}
```

*Prerequisites:* You have xref:../../install/defender_types.adoc#[installed a Defender] somewhere in your environment.

[.procedure]
. Open Console and go to *Defend > Vulnerabilities > Registry*.

. Click *Add registry*.

. In the dialog, enter the following information:

.. In *Version*, select *Amazon EC2 Container Registry*.

.. In *Registry*, enter the URL for the registry.

.. In *Repository*, enter the name of the repository to scan.

.. In the *Tag* field, enter an image tag.
Leave this field blank to scan all tags.

.. Configure how xref:../../configure/credentials_store.adoc#[Prisma Cloud authenticates with AWS].
You can use an IAM user, IAM role, or AWS STS.
+
To authenticate with an IAM role, set *Use IAM role* to *On*.
+
To authenticate with an IAM user, click *Add new* in the *Credential* drop-down list, and create a new AWS credential with an access key ID and secret access key.

.. In *OS type*, specify whether the repo holds *Linux* or *Windows* images.

.. In *Scanner*, select *Automatic*.
+
Console automatically selects an available Defender to execute the scan job.
Alternatively, you can explicitly select a Defender from the drop-down list.
Defenders are listed according to the hosts where they run.
For more information, see xref:../../vulnerability_management/registry_scanning.adoc#_deployment_patterns[deployment patterns].

.. In *Number of scanners*, enter the number of Defenders across which scan jobs can be distributed.

.. Set *Cap* to the number of most recent images to scan.
Leaving *Cap* set to *5* will scan the 5 most recent images.
Setting this field to *0* will scan all images.

.. Click *Add*.

. Click the yellow save button.
+
image::save_button.png[width=50]
+
// ==== Results
//
// Reusable content fragment.
include::frag_results.adoc[leveloffset=0]
